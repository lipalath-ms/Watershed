# ***************************************************************************   
# *	Name: List of watersheds and datasets available for each watershed  *
# *	Author: Lisa Paul Palathingal                                       *
# ***************************************************************************

from pprint import pprint
import requests
import json

# Function Name: listOfWatersheds
# Function Description: The function first displays a list of watersheds available from gstore (from the url specified below). User selects a watershed from the list and the function prints the datasets available for the selected watershed (Datasets are indexed). User selects the index of the data items needed from the dataset. The function prints the requested data items from the dataset.

def listOfWatersheds():
    start = 1
    index = 1
    listOfNames = []
    listOfIds = []
    
    #url containing the datasets
    rDatasets = requests.get('http://gstore.unm.edu/apps/rgis/search/datasets.json?offset=0&version=3') 
    rrData = rDatasets.json()
    pprint(rrData) #prints the content available from the specified url
    results = rrData['results']
    print "\n\n"

    #Get the length of Dataset
    lengthOfDataset = rrData['subtotal']

    #displays the name of all datasets
    print "Name of Datasets available:\n"
    for result in results:
        print index, result['name']
        index += 1
        listOfNames.append(result['name']) #create a list of names of datsets
        listOfIds.append(result['uuid']) #create a list of uuids of datasets
    
    # Function Name: listOfDataSets
    # Function Description: The user is asked to select a name of dataset from the list. Once the user selects the datset, zip file of the dataset is downloaded from gstore.
    def listOfDataSets(lengthOfDataset):
        start = 1
        indexOfDataSet = input("\n\nSelect the name of dataset to be downloaded: \t")
        while start <= lengthOfDataset:
            if indexOfDataSet == start:
                uuid = listOfIds[start - 1]
                basename = listOfNames[start - 1]
                break
            else:
                start += 1
        rDownload = requests.get('http://gstore.unm.edu/apps/rgis/datasets/%s/%s.original.zip' %(uuid, basename))
        with open("Dataset_%i.zip" %indexOfDataSet, "wb") as code:
            code.write(rDownload.content)
                    
    listOfDataSets(lengthOfDataset)  
    while True:
        answer = raw_input("\nDo you want to download more datasets? (Yes/No):\t")
        if answer == "Yes":
            listOfDataSets(lengthOfDataset)
        else:
            print "\n"
            break
       
listOfWatersheds()   
